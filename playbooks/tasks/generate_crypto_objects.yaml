---
- name: Generate private key
  command: openssl genrsa -out {{ item.name }}.key 2048
  args:
    chdir: "{{ ssl_dir.path }}"

- name: Generate CSR
  command: openssl req -new -key {{ item.name }}.key -out {{ item.name }}.csr -subj "/C=LU/ST=Luxembourg/L=Betrange/O=theopendle/CN=aem-ca"
  args:
    chdir: "{{ ssl_dir.path }}"

- name: Convert key to DER
  command: openssl pkcs8 -topk8 -inform PEM -in {{ item.name }}.key -outform DER -out {{ item.name }}.der -nocrypt
  args:
    chdir: "{{ ssl_dir.path }}"